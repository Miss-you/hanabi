var u=Object.defineProperty;var f=(s,t,e)=>t in s?u(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>f(s,typeof t!="symbol"?t+"":t,e);import{g as p,r as h}from"./math-CmfUW7_Q.js";import{F as m}from"./Firework-bLsaGrCq.js";import"./Particle-BIbDLJ2h.js";const d={skyTop:"#020514",skyBottom:"#182042",waterHeight:.2,reflectionAlpha:.3,waterColor:"#000514",trailFade:.2,blendMode:"lighter",autoLaunch:!0,launchRate:.98};class w{constructor(){a(this,"canvas");a(this,"ctx");a(this,"config",{...d});a(this,"particles",[]);a(this,"fireworks",[]);a(this,"width",0);a(this,"height",0);a(this,"loop",()=>{requestAnimationFrame(this.loop),this.update(),this.draw()});this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupControls(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const e=()=>{const i=t.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=i.width,this.height=i.height,this.canvas.width=i.width*n,this.canvas.height=i.height*n,this.canvas.style.width=`${i.width}px`,this.canvas.style.height=`${i.height}px`,this.ctx.scale(n,n)};e(),window.addEventListener("resize",()=>{this.ctx.setTransform(1,0,0,1,0,0),e()})}setupControls(){var i,n;this.bindColorInput("skyTop",o=>this.config.skyTop=o),this.bindColorInput("skyBottom",o=>this.config.skyBottom=o),this.bindColorInput("waterColor",o=>this.config.waterColor=o),this.bindRangeInput("waterHeight","waterHeightVal",o=>this.config.waterHeight=o),this.bindRangeInput("reflectionAlpha","reflectionAlphaVal",o=>this.config.reflectionAlpha=o),this.bindRangeInput("trailFade","trailFadeVal",o=>this.config.trailFade=o),this.bindRangeInput("launchRate","launchRateVal",o=>this.config.launchRate=o);const t=document.getElementById("blendMode");t==null||t.addEventListener("change",()=>{this.config.blendMode=t.value});const e=document.getElementById("autoLaunch");e==null||e.addEventListener("change",()=>{this.config.autoLaunch=e.checked}),(i=document.getElementById("launchBtn"))==null||i.addEventListener("click",()=>{this.launchFirework()}),(n=document.getElementById("resetBtn"))==null||n.addEventListener("click",()=>{this.resetConfig()})}bindColorInput(t,e){const i=document.getElementById(t);i==null||i.addEventListener("input",()=>{e(i.value)})}bindRangeInput(t,e,i){const n=document.getElementById(t),o=document.getElementById(e);n==null||n.addEventListener("input",()=>{const l=parseFloat(n.value);i(l),o&&(o.textContent=l.toFixed(2))})}resetConfig(){this.config={...d},document.getElementById("skyTop").value=this.config.skyTop,document.getElementById("skyBottom").value=this.config.skyBottom,document.getElementById("waterColor").value=this.config.waterColor,document.getElementById("waterHeight").value=String(this.config.waterHeight),document.getElementById("reflectionAlpha").value=String(this.config.reflectionAlpha),document.getElementById("trailFade").value=String(this.config.trailFade),document.getElementById("launchRate").value=String(this.config.launchRate),document.getElementById("blendMode").value=this.config.blendMode,document.getElementById("autoLaunch").checked=this.config.autoLaunch,document.getElementById("waterHeightVal").textContent=this.config.waterHeight.toFixed(2),document.getElementById("reflectionAlphaVal").textContent=this.config.reflectionAlpha.toFixed(2),document.getElementById("trailFadeVal").textContent=this.config.trailFade.toFixed(2),document.getElementById("launchRateVal").textContent=this.config.launchRate.toFixed(2)}launchFirework(){const t=["kiku","willow","botan"],e=t[Math.floor(Math.random()*t.length)],i=p(this.width),n=h(this.height*.15,this.height*.4),o=h(0,360),l=new m(i,n,e,o,this.height,this.width,{onExplode:r=>{this.particles.push(...r)}},.5);this.fireworks.push(l)}drawBackground(){const{ctx:t,width:e,height:i,config:n}=this;t.globalAlpha=1,t.globalCompositeOperation="source-over";const o=t.createLinearGradient(0,0,0,i);o.addColorStop(0,n.skyTop),o.addColorStop(1,n.skyBottom),t.fillStyle=o,t.fillRect(0,0,e,i),t.fillStyle=`rgba(0, 5, 20, ${n.trailFade})`,t.fillRect(0,0,e,i)}drawWater(){const{ctx:t,width:e,height:i,config:n}=this,o=i*(1-n.waterHeight);t.globalCompositeOperation="source-over";const l=parseInt(n.waterColor.slice(1,3),16),r=parseInt(n.waterColor.slice(3,5),16),g=parseInt(n.waterColor.slice(5,7),16),c=t.createLinearGradient(0,o,0,i);c.addColorStop(0,`rgba(${l}, ${r}, ${g}, 0.6)`),c.addColorStop(1,n.waterColor),t.fillStyle=c,t.fillRect(0,o,e,i-o)}update(){this.config.autoLaunch&&Math.random()>this.config.launchRate&&this.launchFirework();for(let t=this.fireworks.length-1;t>=0;t--){const e=this.fireworks[t];e.update(),e.dead&&this.fireworks.splice(t,1)}for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.update(),e.isAlive||this.particles.splice(t,1)}}draw(){const{ctx:t,config:e}=this;this.drawBackground(),t.globalCompositeOperation=e.blendMode;for(const i of this.fireworks)i.draw(t);for(const i of this.particles)i.draw(t,this.height);this.drawWater(),t.globalCompositeOperation="source-over",t.globalAlpha=.5,t.fillStyle="#fff",t.font="12px monospace",t.fillText(`粒子数: ${this.particles.length} | 烟花数: ${this.fireworks.length}`,10,20)}}new w;
