import{h as o,r as h}from"./math-BLsufJHS.js";import{P as d}from"./Particle-CCsMxs2b.js";const l={friction:.95,gravity:.05,decay:.01,trail:10,lineWidth:2,hue:0,count:50,speed:5};class p{canvas;ctx;particles=[];params={...l};constructor(){this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupEventListeners(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const e=t.getBoundingClientRect(),i=window.devicePixelRatio||1;this.canvas.width=e.width*i,this.canvas.height=e.height*i,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.ctx.scale(i,i),window.addEventListener("resize",()=>this.setupCanvas())}setupEventListeners(){this.canvas.addEventListener("click",t=>{const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;this.emitAt(i,s)}),document.getElementById("emitBtn")?.addEventListener("click",()=>{const t=this.canvas.getBoundingClientRect();this.emitAt(t.width/2,t.height/2)}),document.getElementById("clearBtn")?.addEventListener("click",()=>{this.particles=[]}),document.getElementById("resetBtn")?.addEventListener("click",()=>{this.resetParams()}),this.setupSlider("friction",t=>this.params.friction=t),this.setupSlider("gravity",t=>this.params.gravity=t),this.setupSlider("decay",t=>this.params.decay=t),this.setupSlider("trail",t=>this.params.trail=t),this.setupSlider("lineWidth",t=>this.params.lineWidth=t),this.setupSlider("hue",t=>this.params.hue=t),this.setupSlider("count",t=>this.params.count=t),this.setupSlider("speed",t=>this.params.speed=t)}setupSlider(t,e){const i=document.getElementById(t),s=document.getElementById(`${t}Val`);i&&i.addEventListener("input",()=>{const a=parseFloat(i.value);e(a),s&&(s.textContent=i.value)})}resetParams(){this.params={...l};const t=["friction","gravity","decay","trail","lineWidth","hue","count","speed"];for(const e of t){const i=document.getElementById(e),s=document.getElementById(`${e}Val`);i&&(i.value=String(this.params[e]),s&&(s.textContent=String(this.params[e])))}}emitAt(t,e){const i={friction:this.params.friction,gravity:this.params.gravity,decayMin:this.params.decay*.8,decayMax:this.params.decay*1.2,maxHistory:this.params.trail,lineWidth:this.params.lineWidth},s=o(this.params.hue,100,60);for(let a=0;a<this.params.count;a++){const n=new d(t,e,s,"kiku",i),c=h(0,Math.PI*2),r=h(this.params.speed*.5,this.params.speed*1.5);n.setVelocity(Math.cos(c)*r,Math.sin(c)*r),this.particles.push(n)}}update(){for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.update(),e.isAlive||this.particles.splice(t,1)}}draw(){const t=this.canvas.getBoundingClientRect();this.ctx.globalAlpha=1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.fillStyle="rgba(0, 5, 20, 0.2)",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.globalCompositeOperation="lighter";for(const e of this.particles)e.draw(this.ctx,t.height);this.ctx.globalCompositeOperation="source-over",this.ctx.globalAlpha=.5,this.ctx.fillStyle="#fff",this.ctx.font="12px monospace",this.ctx.fillText(`粒子数: ${this.particles.length}`,10,20)}loop=()=>{requestAnimationFrame(this.loop),this.update(),this.draw()}}new p;
