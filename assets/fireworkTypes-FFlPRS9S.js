import{r as d}from"./math-BLsufJHS.js";import{F as u}from"./Firework-Dr4BiqZG.js";import"./Particle-CCsMxs2b.js";class f{panels=new Map;constructor(){this.initPanels(),this.loop()}initPanels(){document.querySelectorAll(".firework-panel").forEach(t=>{const a=t.getAttribute("data-type"),r=t.querySelector(".preview-canvas"),i=r.getContext("2d");if(!i)return;const p=r.getBoundingClientRect(),s=window.devicePixelRatio||1;r.width=p.width*s,r.height=p.height*s,i.scale(s,s);const n={canvas:r,ctx:i,particles:[],fireworks:[],type:a,params:{count:parseInt(t.querySelector('[data-param="count"]')?.value||"100"),speed:parseInt(t.querySelector('[data-param="speed"]')?.value||"5"),gravity:parseFloat(t.querySelector('[data-param="gravity"]')?.value||"0.05")}};this.panels.set(a,n),t.querySelector(".launch-btn")?.addEventListener("click",()=>{this.launchFirework(a)}),t.querySelectorAll("input[data-param]").forEach(h=>{h.addEventListener("input",o=>{const c=o.target,l=c.getAttribute("data-param");l&&l in n.params&&(n.params[l]=parseFloat(c.value))})})})}launchFirework(e){const t=this.panels.get(e);if(!t)return;const a=t.canvas.getBoundingClientRect(),r=a.width/2,i=a.height*.3,p=d(0,360),s=new u(r,i,e,p,a.height,a.width,{onExplode:n=>{n.forEach(o=>{const c=Math.atan2(o.vy,o.vx),l=Math.sqrt(o.vx*o.vx+o.vy*o.vy)*(t.params.speed/5);o.vx=Math.cos(c)*l,o.vy=Math.sin(c)*l});const h=n.slice(0,t.params.count);t.particles.push(...h)}},.5);t.fireworks.push(s)}updatePanel(e){for(let t=e.fireworks.length-1;t>=0;t--){const a=e.fireworks[t];a.update(),a.dead&&e.fireworks.splice(t,1)}for(let t=e.particles.length-1;t>=0;t--){const a=e.particles[t];a.update(),a.isAlive||e.particles.splice(t,1)}}drawPanel(e){const{ctx:t,canvas:a}=e,r=a.getBoundingClientRect();t.globalAlpha=1,t.fillStyle="#000",t.fillRect(0,0,r.width,r.height),t.fillStyle="rgba(0, 5, 20, 0.2)",t.fillRect(0,0,r.width,r.height),t.globalCompositeOperation="lighter";for(const i of e.fireworks)i.draw(t);for(const i of e.particles)i.draw(t,r.height);t.globalCompositeOperation="source-over"}loop=()=>{requestAnimationFrame(this.loop);for(const e of this.panels.values())this.updatePanel(e),this.drawPanel(e)}}new f;
