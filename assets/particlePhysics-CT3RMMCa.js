var p=Object.defineProperty;var m=(n,t,i)=>t in n?p(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var c=(n,t,i)=>m(n,typeof t!="symbol"?t+"":t,i);import{h as u,r as o}from"./math-CmfUW7_Q.js";import{P as g}from"./Particle-BIbDLJ2h.js";const d={friction:.95,gravity:.05,decay:.01,trail:10,lineWidth:2,hue:0,count:50,speed:5};class v{constructor(){c(this,"canvas");c(this,"ctx");c(this,"particles",[]);c(this,"params",{...d});c(this,"loop",()=>{requestAnimationFrame(this.loop),this.update(),this.draw()});this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupEventListeners(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const i=t.getBoundingClientRect(),s=window.devicePixelRatio||1;this.canvas.width=i.width*s,this.canvas.height=i.height*s,this.canvas.style.width=`${i.width}px`,this.canvas.style.height=`${i.height}px`,this.ctx.scale(s,s),window.addEventListener("resize",()=>this.setupCanvas())}setupEventListeners(){var t,i,s;this.canvas.addEventListener("click",e=>{const a=this.canvas.getBoundingClientRect(),r=e.clientX-a.left,h=e.clientY-a.top;this.emitAt(r,h)}),(t=document.getElementById("emitBtn"))==null||t.addEventListener("click",()=>{const e=this.canvas.getBoundingClientRect();this.emitAt(e.width/2,e.height/2)}),(i=document.getElementById("clearBtn"))==null||i.addEventListener("click",()=>{this.particles=[]}),(s=document.getElementById("resetBtn"))==null||s.addEventListener("click",()=>{this.resetParams()}),this.setupSlider("friction",e=>this.params.friction=e),this.setupSlider("gravity",e=>this.params.gravity=e),this.setupSlider("decay",e=>this.params.decay=e),this.setupSlider("trail",e=>this.params.trail=e),this.setupSlider("lineWidth",e=>this.params.lineWidth=e),this.setupSlider("hue",e=>this.params.hue=e),this.setupSlider("count",e=>this.params.count=e),this.setupSlider("speed",e=>this.params.speed=e)}setupSlider(t,i){const s=document.getElementById(t),e=document.getElementById(`${t}Val`);s&&s.addEventListener("input",()=>{const a=parseFloat(s.value);i(a),e&&(e.textContent=s.value)})}resetParams(){this.params={...d};const t=["friction","gravity","decay","trail","lineWidth","hue","count","speed"];for(const i of t){const s=document.getElementById(i),e=document.getElementById(`${i}Val`);s&&(s.value=String(this.params[i]),e&&(e.textContent=String(this.params[i])))}}emitAt(t,i){const s={friction:this.params.friction,gravity:this.params.gravity,decayMin:this.params.decay*.8,decayMax:this.params.decay*1.2,maxHistory:this.params.trail,lineWidth:this.params.lineWidth},e=u(this.params.hue,100,60);for(let a=0;a<this.params.count;a++){const r=new g(t,i,e,"kiku",s),h=o(0,Math.PI*2),l=o(this.params.speed*.5,this.params.speed*1.5);r.setVelocity(Math.cos(h)*l,Math.sin(h)*l),this.particles.push(r)}}update(){for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.update(),i.isAlive||this.particles.splice(t,1)}}draw(){const t=this.canvas.getBoundingClientRect();this.ctx.globalAlpha=1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.fillStyle="rgba(0, 5, 20, 0.2)",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.globalCompositeOperation="lighter";for(const i of this.particles)i.draw(this.ctx,t.height);this.ctx.globalCompositeOperation="source-over",this.ctx.globalAlpha=.5,this.ctx.fillStyle="#fff",this.ctx.font="12px monospace",this.ctx.fillText(`粒子数: ${this.particles.length}`,10,20)}}new v;
