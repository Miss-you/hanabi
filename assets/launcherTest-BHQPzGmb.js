var m=Object.defineProperty;var y=(h,t,n)=>t in h?m(h,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[t]=n;var c=(h,t,n)=>y(h,typeof t!="symbol"?t+"":t,n);import{r as d}from"./math-CmfUW7_Q.js";import{V as g}from"./Particle-BIbDLJ2h.js";import{F as u}from"./Firework-bLsaGrCq.js";class w{constructor(){c(this,"canvas");c(this,"ctx");c(this,"config",{launchX:50,targetY:25,type:"kiku",salvoCount:5,salvoDelay:50,distribution:"spread",energy:.5});c(this,"particles",[]);c(this,"fireworks",[]);c(this,"width",0);c(this,"height",0);c(this,"loop",()=>{requestAnimationFrame(this.loop),this.update(),this.draw()});this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupControls(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const n=()=>{const i=t.getBoundingClientRect(),e=window.devicePixelRatio||1;this.width=i.width,this.height=i.height,this.canvas.width=i.width*e,this.canvas.height=i.height*e,this.canvas.style.width=`${i.width}px`,this.canvas.style.height=`${i.height}px`,this.ctx.scale(e,e)};n(),window.addEventListener("resize",()=>{this.ctx.setTransform(1,0,0,1,0,0),n()});const s=document.getElementById("crosshair");t.addEventListener("mousemove",i=>{const e=t.getBoundingClientRect(),o=i.clientX-e.left,a=i.clientY-e.top;s&&(s.style.display="block",s.style.left=`${o}px`,s.style.top=`${a}px`)}),t.addEventListener("mouseleave",()=>{s&&(s.style.display="none")}),t.addEventListener("click",i=>{const e=t.getBoundingClientRect(),o=(i.clientX-e.left)/e.width*100,a=(i.clientY-e.top)/e.height*100;this.config.launchX=Math.max(5,Math.min(95,o)),this.config.targetY=Math.max(10,Math.min(60,a)),document.getElementById("launchX").value=String(this.config.launchX),document.getElementById("targetY").value=String(this.config.targetY),document.getElementById("launchXVal").textContent=`${Math.round(this.config.launchX)}%`,document.getElementById("targetYVal").textContent=`${Math.round(this.config.targetY)}%`,this.launchSingle()})}setupControls(){var n,s,i;this.bindRangeInput("launchX","launchXVal",e=>this.config.launchX=e,"%"),this.bindRangeInput("targetY","targetYVal",e=>this.config.targetY=e,"%"),this.bindRangeInput("salvoCount","salvoCountVal",e=>this.config.salvoCount=e),this.bindRangeInput("salvoDelay","salvoDelayVal",e=>this.config.salvoDelay=e,"ms"),this.bindRangeInput("energy","energyVal",e=>this.config.energy=e),document.querySelectorAll(".type-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(o=>o.classList.remove("active")),e.classList.add("active"),this.config.type=e.getAttribute("data-type")})});const t=document.getElementById("distribution");t==null||t.addEventListener("change",()=>{this.config.distribution=t.value}),(n=document.getElementById("singleBtn"))==null||n.addEventListener("click",()=>this.launchSingle()),(s=document.getElementById("salvoBtn"))==null||s.addEventListener("click",()=>this.launchSalvo()),(i=document.getElementById("clearBtn"))==null||i.addEventListener("click",()=>this.clear())}bindRangeInput(t,n,s,i=""){const e=document.getElementById(t),o=document.getElementById(n);e==null||e.addEventListener("input",()=>{const a=parseFloat(e.value);s(a),o&&(o.textContent=i==="%"?`${Math.round(a)}${i}`:`${a.toFixed(2)}${i}`)})}getFireworkType(){if(this.config.type==="random"){const t=["kiku","willow","botan"];return t[Math.floor(Math.random()*t.length)]}return this.config.type}launchSingle(){const t=this.config.launchX/100*this.width,n=this.config.targetY/100*this.height,s=d(0,360),i=this.getFireworkType(),e=new u(t,n,i,s,this.height,this.width,{onExplode:o=>this.particles.push(...o)},this.config.energy);this.fireworks.push(e)}launchSalvo(){const{salvoCount:t,salvoDelay:n,distribution:s}=this.config;for(let i=0;i<t;i++)setTimeout(()=>{let e;const o=this.config.launchX/100*this.width;switch(s){case"center":e=o+d(-30,30);break;case"spread":e=this.width*(.1+.8*i/(t-1||1));break;case"random":e=d(this.width*.1,this.width*.9);break;default:e=o}const a=this.config.targetY/100*this.height+d(-50,50),r=d(0,360),l=this.getFireworkType(),p=new u(e,Math.max(this.height*.1,Math.min(this.height*.6,a)),l,r,this.height,this.width,{onExplode:f=>this.particles.push(...f)},this.config.energy);this.fireworks.push(p)},i*n)}clear(){this.particles=[],this.fireworks=[]}update(){for(let t=this.fireworks.length-1;t>=0;t--){const n=this.fireworks[t];n.update(),n.dead&&this.fireworks.splice(t,1)}for(let t=this.particles.length-1;t>=0;t--){const n=this.particles[t];n.update(),n.isAlive||this.particles.splice(t,1)}document.getElementById("particleCount").textContent=String(this.particles.length),document.getElementById("fireworkCount").textContent=String(this.fireworks.length)}draw(){const{ctx:t,width:n,height:s}=this;t.globalAlpha=1,t.globalCompositeOperation="source-over";const i=t.createLinearGradient(0,0,0,s);i.addColorStop(0,g.SKY_GRADIENT_TOP),i.addColorStop(1,g.SKY_GRADIENT_BOTTOM),t.fillStyle=i,t.fillRect(0,0,n,s),t.fillStyle="rgba(0, 5, 20, 0.2)",t.fillRect(0,0,n,s);const e=this.config.launchX/100*n,o=this.config.targetY/100*s;t.globalAlpha=.3,t.strokeStyle="#fff",t.setLineDash([5,5]),t.beginPath(),t.moveTo(e,s),t.lineTo(e,o),t.stroke(),t.beginPath(),t.arc(e,o,10,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.globalCompositeOperation="lighter";for(const l of this.fireworks)l.draw(t);for(const l of this.particles)l.draw(t,s);t.globalCompositeOperation="source-over";const a=s*(1-g.WATER_HEIGHT_RATIO),r=t.createLinearGradient(0,a,0,s);r.addColorStop(0,"rgba(0, 5, 20, 0.6)"),r.addColorStop(1,"#000"),t.fillStyle=r,t.fillRect(0,a,n,s-a)}}new w;
