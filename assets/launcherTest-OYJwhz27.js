import{r}from"./math-BLsufJHS.js";import{V as l}from"./Particle-CCsMxs2b.js";import{F as d}from"./Firework-Dr4BiqZG.js";class p{canvas;ctx;config={launchX:50,targetY:25,type:"kiku",salvoCount:5,salvoDelay:50,distribution:"spread",energy:.5};particles=[];fireworks=[];width=0;height=0;constructor(){this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupControls(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const e=()=>{const i=t.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=i.width,this.height=i.height,this.canvas.width=i.width*n,this.canvas.height=i.height*n,this.canvas.style.width=`${i.width}px`,this.canvas.style.height=`${i.height}px`,this.ctx.scale(n,n)};e(),window.addEventListener("resize",()=>{this.ctx.setTransform(1,0,0,1,0,0),e()});const s=document.getElementById("crosshair");t.addEventListener("mousemove",i=>{const n=t.getBoundingClientRect(),o=i.clientX-n.left,a=i.clientY-n.top;s&&(s.style.display="block",s.style.left=`${o}px`,s.style.top=`${a}px`)}),t.addEventListener("mouseleave",()=>{s&&(s.style.display="none")}),t.addEventListener("click",i=>{const n=t.getBoundingClientRect(),o=(i.clientX-n.left)/n.width*100,a=(i.clientY-n.top)/n.height*100;this.config.launchX=Math.max(5,Math.min(95,o)),this.config.targetY=Math.max(10,Math.min(60,a)),document.getElementById("launchX").value=String(this.config.launchX),document.getElementById("targetY").value=String(this.config.targetY),document.getElementById("launchXVal").textContent=`${Math.round(this.config.launchX)}%`,document.getElementById("targetYVal").textContent=`${Math.round(this.config.targetY)}%`,this.launchSingle()})}setupControls(){this.bindRangeInput("launchX","launchXVal",e=>this.config.launchX=e,"%"),this.bindRangeInput("targetY","targetYVal",e=>this.config.targetY=e,"%"),this.bindRangeInput("salvoCount","salvoCountVal",e=>this.config.salvoCount=e),this.bindRangeInput("salvoDelay","salvoDelayVal",e=>this.config.salvoDelay=e,"ms"),this.bindRangeInput("energy","energyVal",e=>this.config.energy=e),document.querySelectorAll(".type-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".type-btn").forEach(s=>s.classList.remove("active")),e.classList.add("active"),this.config.type=e.getAttribute("data-type")})});const t=document.getElementById("distribution");t?.addEventListener("change",()=>{this.config.distribution=t.value}),document.getElementById("singleBtn")?.addEventListener("click",()=>this.launchSingle()),document.getElementById("salvoBtn")?.addEventListener("click",()=>this.launchSalvo()),document.getElementById("clearBtn")?.addEventListener("click",()=>this.clear())}bindRangeInput(t,e,s,i=""){const n=document.getElementById(t),o=document.getElementById(e);n?.addEventListener("input",()=>{const a=parseFloat(n.value);s(a),o&&(o.textContent=i==="%"?`${Math.round(a)}${i}`:`${a.toFixed(2)}${i}`)})}getFireworkType(){if(this.config.type==="random"){const t=["kiku","willow","botan"];return t[Math.floor(Math.random()*t.length)]}return this.config.type}launchSingle(){const t=this.config.launchX/100*this.width,e=this.config.targetY/100*this.height,s=r(0,360),i=this.getFireworkType(),n=new d(t,e,i,s,this.height,this.width,{onExplode:o=>this.particles.push(...o)},this.config.energy);this.fireworks.push(n)}launchSalvo(){const{salvoCount:t,salvoDelay:e,distribution:s}=this.config;for(let i=0;i<t;i++)setTimeout(()=>{let n;const o=this.config.launchX/100*this.width;switch(s){case"center":n=o+r(-30,30);break;case"spread":n=this.width*(.1+.8*i/(t-1||1));break;case"random":n=r(this.width*.1,this.width*.9);break;default:n=o}const a=this.config.targetY/100*this.height+r(-50,50),c=r(0,360),h=this.getFireworkType(),g=new d(n,Math.max(this.height*.1,Math.min(this.height*.6,a)),h,c,this.height,this.width,{onExplode:u=>this.particles.push(...u)},this.config.energy);this.fireworks.push(g)},i*e)}clear(){this.particles=[],this.fireworks=[]}update(){for(let t=this.fireworks.length-1;t>=0;t--){const e=this.fireworks[t];e.update(),e.dead&&this.fireworks.splice(t,1)}for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.update(),e.isAlive||this.particles.splice(t,1)}document.getElementById("particleCount").textContent=String(this.particles.length),document.getElementById("fireworkCount").textContent=String(this.fireworks.length)}draw(){const{ctx:t,width:e,height:s}=this;t.globalAlpha=1,t.globalCompositeOperation="source-over";const i=t.createLinearGradient(0,0,0,s);i.addColorStop(0,l.SKY_GRADIENT_TOP),i.addColorStop(1,l.SKY_GRADIENT_BOTTOM),t.fillStyle=i,t.fillRect(0,0,e,s),t.fillStyle="rgba(0, 5, 20, 0.2)",t.fillRect(0,0,e,s);const n=this.config.launchX/100*e,o=this.config.targetY/100*s;t.globalAlpha=.3,t.strokeStyle="#fff",t.setLineDash([5,5]),t.beginPath(),t.moveTo(n,s),t.lineTo(n,o),t.stroke(),t.beginPath(),t.arc(n,o,10,0,Math.PI*2),t.stroke(),t.setLineDash([]),t.globalCompositeOperation="lighter";for(const h of this.fireworks)h.draw(t);for(const h of this.particles)h.draw(t,s);t.globalCompositeOperation="source-over";const a=s*(1-l.WATER_HEIGHT_RATIO),c=t.createLinearGradient(0,a,0,s);c.addColorStop(0,"rgba(0, 5, 20, 0.6)"),c.addColorStop(1,"#000"),t.fillStyle=c,t.fillRect(0,a,e,s-a)}loop=()=>{requestAnimationFrame(this.loop),this.update(),this.draw()}}new p;
