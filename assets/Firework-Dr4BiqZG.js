import{P as p}from"./Particle-CCsMxs2b.js";import{r as e,h as c}from"./math-BLsufJHS.js";class g{x;y;targetY;type;hue;energy;delay;vx;vy;gravity=.25;trail=[];travelTime;frames=0;callbacks;exploded=!1;dead=!1;constructor(t,i,y,n,l,r,a,o=.5,h=0){this.x=t,this.y=l,this.targetY=i,this.type=y,this.hue=n,this.energy=o,this.delay=h,this.callbacks=a;const s=l-i,d=Math.sqrt(2*this.gravity*s);this.vx=(r/2-t)*.005+e(-.5,.5),this.vy=-d,this.travelTime=Math.ceil(d/this.gravity)}update(){if(this.delay>0){this.delay--;return}this.exploded||(this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy,this.frames++,this.trail.push({x:this.x,y:this.y,alpha:1}),this.trail.length>10&&this.trail.shift(),this.trail.forEach(t=>t.alpha-=.1),(this.vy>=0||this.frames>=this.travelTime)&&this.explode())}draw(t){if(!(this.delay>0||this.exploded)){if(t.globalAlpha=1,t.strokeStyle=c(this.hue,80,80),t.lineWidth=2,t.beginPath(),this.trail.length>1){t.moveTo(this.trail[0].x,this.trail[0].y);for(let i=1;i<this.trail.length;i++)t.lineTo(this.trail[i].x,this.trail[i].y);t.stroke()}t.fillStyle="#fff",t.beginPath(),t.arc(this.x,this.y,3,0,Math.PI*2),t.fill()}}explode(){this.exploded=!0,this.dead=!0;const t=this.createParticles();this.callbacks.onExplode(t)}createParticles(){const t=[],i=this.energy*2,y=this.type==="kiku"?150:this.type==="willow"?100:80,n=Math.min(400,Math.floor(y*(.8+i*.5))),l=c(this.hue,100,60);for(let r=0;r<n;r++){const a=new p(this.x,this.y,l,this.type),o=e(0,Math.PI*2),h=.8+i*.4;let s;switch(this.type){case"kiku":s=e(3,6)*h;break;case"willow":s=e(2,5)*h,a.setColor(c(45,100,e(50,80)));break;case"botan":s=e(1,8)*h;break;case"piano":s=e(1,4)*h;break;default:s=e(2,5)*h}a.setVelocity(Math.cos(o)*s,Math.sin(o)*s),t.push(a)}return t}explodeNow(){this.y=this.targetY,this.vy=0,this.explode()}}export{g as F};
