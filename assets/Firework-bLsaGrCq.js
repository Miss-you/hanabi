var u=Object.defineProperty;var v=(l,t,s)=>t in l?u(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var i=(l,t,s)=>v(l,typeof t!="symbol"?t+"":t,s);import{P as g}from"./Particle-BIbDLJ2h.js";import{r as h,h as p}from"./math-CmfUW7_Q.js";class x{constructor(t,s,c,d,o,y,r,n=.5,a=0){i(this,"x");i(this,"y");i(this,"targetY");i(this,"type");i(this,"hue");i(this,"energy");i(this,"delay");i(this,"vx");i(this,"vy");i(this,"gravity",.25);i(this,"trail",[]);i(this,"travelTime");i(this,"frames",0);i(this,"callbacks");i(this,"exploded",!1);i(this,"dead",!1);this.x=t,this.y=o,this.targetY=s,this.type=c,this.hue=d,this.energy=n,this.delay=a,this.callbacks=r;const e=o-s,f=Math.sqrt(2*this.gravity*e);this.vx=(y/2-t)*.005+h(-.5,.5),this.vy=-f,this.travelTime=Math.ceil(f/this.gravity)}update(){if(this.delay>0){this.delay--;return}this.exploded||(this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy,this.frames++,this.trail.push({x:this.x,y:this.y,alpha:1}),this.trail.length>10&&this.trail.shift(),this.trail.forEach(t=>t.alpha-=.1),(this.vy>=0||this.frames>=this.travelTime)&&this.explode())}draw(t){if(!(this.delay>0||this.exploded)){if(t.globalAlpha=1,t.strokeStyle=p(this.hue,80,80),t.lineWidth=2,t.beginPath(),this.trail.length>1){t.moveTo(this.trail[0].x,this.trail[0].y);for(let s=1;s<this.trail.length;s++)t.lineTo(this.trail[s].x,this.trail[s].y);t.stroke()}t.fillStyle="#fff",t.beginPath(),t.arc(this.x,this.y,3,0,Math.PI*2),t.fill()}}explode(){this.exploded=!0,this.dead=!0;const t=this.createParticles();this.callbacks.onExplode(t)}createParticles(){const t=[],s=this.energy*2,c=this.type==="kiku"?150:this.type==="willow"?100:80,d=Math.min(400,Math.floor(c*(.8+s*.5))),o=p(this.hue,100,60);for(let y=0;y<d;y++){const r=new g(this.x,this.y,o,this.type),n=h(0,Math.PI*2),a=.8+s*.4;let e;switch(this.type){case"kiku":e=h(3,6)*a;break;case"willow":e=h(2,5)*a,r.setColor(p(45,100,h(50,80)));break;case"botan":e=h(1,8)*a;break;case"piano":e=h(1,4)*a;break;default:e=h(2,5)*a}r.setVelocity(Math.cos(n)*e,Math.sin(n)*e),t.push(r)}return t}explodeNow(){this.y=this.targetY,this.vy=0,this.explode()}}export{x as F};
