import{g as d,r}from"./math-BLsufJHS.js";import{F as g}from"./Firework-Dr4BiqZG.js";import"./Particle-CCsMxs2b.js";const c={skyTop:"#020514",skyBottom:"#182042",waterHeight:.2,reflectionAlpha:.3,waterColor:"#000514",trailFade:.2,blendMode:"lighter",autoLaunch:!0,launchRate:.98};class u{canvas;ctx;config={...c};particles=[];fireworks=[];width=0;height=0;constructor(){this.canvas=document.getElementById("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Cannot get canvas context");this.ctx=t,this.setupCanvas(),this.setupControls(),this.loop()}setupCanvas(){const t=document.querySelector(".canvas-container");if(!t)return;const i=()=>{const e=t.getBoundingClientRect(),n=window.devicePixelRatio||1;this.width=e.width,this.height=e.height,this.canvas.width=e.width*n,this.canvas.height=e.height*n,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.ctx.scale(n,n)};i(),window.addEventListener("resize",()=>{this.ctx.setTransform(1,0,0,1,0,0),i()})}setupControls(){this.bindColorInput("skyTop",e=>this.config.skyTop=e),this.bindColorInput("skyBottom",e=>this.config.skyBottom=e),this.bindColorInput("waterColor",e=>this.config.waterColor=e),this.bindRangeInput("waterHeight","waterHeightVal",e=>this.config.waterHeight=e),this.bindRangeInput("reflectionAlpha","reflectionAlphaVal",e=>this.config.reflectionAlpha=e),this.bindRangeInput("trailFade","trailFadeVal",e=>this.config.trailFade=e),this.bindRangeInput("launchRate","launchRateVal",e=>this.config.launchRate=e);const t=document.getElementById("blendMode");t?.addEventListener("change",()=>{this.config.blendMode=t.value});const i=document.getElementById("autoLaunch");i?.addEventListener("change",()=>{this.config.autoLaunch=i.checked}),document.getElementById("launchBtn")?.addEventListener("click",()=>{this.launchFirework()}),document.getElementById("resetBtn")?.addEventListener("click",()=>{this.resetConfig()})}bindColorInput(t,i){const e=document.getElementById(t);e?.addEventListener("input",()=>{i(e.value)})}bindRangeInput(t,i,e){const n=document.getElementById(t),o=document.getElementById(i);n?.addEventListener("input",()=>{const a=parseFloat(n.value);e(a),o&&(o.textContent=a.toFixed(2))})}resetConfig(){this.config={...c},document.getElementById("skyTop").value=this.config.skyTop,document.getElementById("skyBottom").value=this.config.skyBottom,document.getElementById("waterColor").value=this.config.waterColor,document.getElementById("waterHeight").value=String(this.config.waterHeight),document.getElementById("reflectionAlpha").value=String(this.config.reflectionAlpha),document.getElementById("trailFade").value=String(this.config.trailFade),document.getElementById("launchRate").value=String(this.config.launchRate),document.getElementById("blendMode").value=this.config.blendMode,document.getElementById("autoLaunch").checked=this.config.autoLaunch,document.getElementById("waterHeightVal").textContent=this.config.waterHeight.toFixed(2),document.getElementById("reflectionAlphaVal").textContent=this.config.reflectionAlpha.toFixed(2),document.getElementById("trailFadeVal").textContent=this.config.trailFade.toFixed(2),document.getElementById("launchRateVal").textContent=this.config.launchRate.toFixed(2)}launchFirework(){const t=["kiku","willow","botan"],i=t[Math.floor(Math.random()*t.length)],e=d(this.width),n=r(this.height*.15,this.height*.4),o=r(0,360),a=new g(e,n,i,o,this.height,this.width,{onExplode:s=>{this.particles.push(...s)}},.5);this.fireworks.push(a)}drawBackground(){const{ctx:t,width:i,height:e,config:n}=this;t.globalAlpha=1,t.globalCompositeOperation="source-over";const o=t.createLinearGradient(0,0,0,e);o.addColorStop(0,n.skyTop),o.addColorStop(1,n.skyBottom),t.fillStyle=o,t.fillRect(0,0,i,e),t.fillStyle=`rgba(0, 5, 20, ${n.trailFade})`,t.fillRect(0,0,i,e)}drawWater(){const{ctx:t,width:i,height:e,config:n}=this,o=e*(1-n.waterHeight);t.globalCompositeOperation="source-over";const a=parseInt(n.waterColor.slice(1,3),16),s=parseInt(n.waterColor.slice(3,5),16),h=parseInt(n.waterColor.slice(5,7),16),l=t.createLinearGradient(0,o,0,e);l.addColorStop(0,`rgba(${a}, ${s}, ${h}, 0.6)`),l.addColorStop(1,n.waterColor),t.fillStyle=l,t.fillRect(0,o,i,e-o)}update(){this.config.autoLaunch&&Math.random()>this.config.launchRate&&this.launchFirework();for(let t=this.fireworks.length-1;t>=0;t--){const i=this.fireworks[t];i.update(),i.dead&&this.fireworks.splice(t,1)}for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.update(),i.isAlive||this.particles.splice(t,1)}}draw(){const{ctx:t,config:i}=this;this.drawBackground(),t.globalCompositeOperation=i.blendMode;for(const e of this.fireworks)e.draw(t);for(const e of this.particles)e.draw(t,this.height);this.drawWater(),t.globalCompositeOperation="source-over",t.globalAlpha=.5,t.fillStyle="#fff",t.font="12px monospace",t.fillText(`粒子数: ${this.particles.length} | 烟花数: ${this.fireworks.length}`,10,20)}loop=()=>{requestAnimationFrame(this.loop),this.update(),this.draw()}}new u;
